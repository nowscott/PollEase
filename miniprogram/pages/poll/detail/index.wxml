<!--pages/poll/detail/index.wxml-->
<view class="page-wrapper">
  <view class="container">
    <view class="poll-header">
      <view class="poll-title">{{poll.title}}</view>
      <view class="poll-meta">
        <text class="meta-item">创建时间：{{poll.createTimeStr}}</text>
        <text class="meta-item">截止时间：{{poll.endTimeStr}}</text>
      </view>
    </view>

    <block wx:if="{{loading}}">
      <view class="loading">
        <text>加载中...</text>
      </view>
    </block>

    <block wx:elif="{{error}}">
      <view class="error">
        <text>{{error}}</text>
        <button bindtap="fetchPollDetail" class="retry-btn">重新加载</button>
      </view>
    </block>

    <block wx:elif="{{poll}}">
      <view class="poll-content">
        <view class="poll-status" wx:if="{{isExpired || hasVoted}}">
          <text wx:if="{{isExpired}}" class="expired-tag">投票已结束</text>
          <text wx:elif="{{hasVoted}}" class="voted-tag">已完成投票</text>
        </view>

        <view class="poll-options">
          <block wx:for="{{poll.sortedOptions}}" wx:key="index">
            <view 
              class="option {{hasVoted || isExpired ? 'disabled' : 'can-vote'}}"
              data-original-index="{{item.index}}"
              hover-class="{{(!hasVoted && !isExpired) ? 'option-hover' : ''}}"
              bindtap="{{(!hasVoted && !isExpired) ? 'submitVote' : ''}}"
            >
              <view class="option-background" style="opacity: {{calculateVotePercentage(item) === '0%' ? 0 : (parseFloat(calculateVotePercentage(item)) / 100) * 0.3}}"></view>
              
              <view class="option-content">
                <text class="option-text">{{item.text}}</text>
                <view class="vote-info">
                  <text class="vote-count">{{item.votes}} 票</text>
                  <text class="vote-percentage">{{calculateVotePercentage(item)}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
      </view>

      <view class="share-section">
        <button class="share-btn" open-type="share">
          邀请好友投票
        </button>
      </view>
    </block>
  </view>
</view>